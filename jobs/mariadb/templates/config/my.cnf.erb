[client]
#password =

[mysqld]
port      = <%= p("mariadb.port") %>
socket    = /var/vcap/sys/run/mariadb/mariadb.sock

# Where you want to have your database
data     = /var/vcap/store/mariadb
pid-file = /var/vcap/sys/run/mariadb/mariadb.pid

# Where you have your mariadb/MariaDB source + sql/share/english
language = /var/vcap/packages/mariadb/dir/sql/share/english

[mysqld_safe]
nice      = 0
log-error = /var/vcap/sys/log/mariadb/mariadbd.err.log

[mysqld]
collation_server        = utf8_unicode_ci
character_set_server    = utf8
user      = vcap
pid-file  = /var/vcap/sys/run/mariadb/mysqld.pid
socket    = /var/vcap/sys/run/mariadb/mysqld.sock
port      = <%= p("mariadb.port") %>
basedir   = /var/vcap/packages/mariadb
datadir   = /var/vcap/store/mariadb
tmpdir    = /var/vcap/sys/tmp/mariadb

lc-messages-dir=/var/vcap/packages/mariadb/share/

#production optimizations taken cloudfoundry/bosh-sample-release
key_buffer              = <%= p("mariadb.production") ? '3276M' : '16M' %>
innodb_buffer_pool_size = <%= p("mariadb.production") ? '3276M' : '256M' %>
max_allowed_packet      = 16M
thread_stack            = 256K
thread_cache_size       = <%= p("mariadb.production") ? 128 : 8 %>
thread_concurrency      = <%= p("mariadb.production") ? 8 : 2 %>
max_connections         = <%= p("mariadb.production") ? 512 : 16 %>
table_cache             = <%= p("mariadb.production") ? 2048 : 256 %>
myisam-recover          = BACKUP
query_cache_limit       = 1M
query_cache_size        = <%= p("mariadb.production") ? '128M' : '16M' %>
expire_logs_days        = 10
max_binlog_size         = 100M

[aria]
aria-log-dir-path=/var/vcap/store/mariadb

[mysqldump]
quick
quote-names
max_allowed_packet = 16M

[mysql]

[isamchk]
key_buffer = 16M

[clustering]
wsrep_provider=/var/vcap/packages/galera/lib/libgalera_smm.so

<% if_p("mariadb.leader_address") do |leader_address| %>
  <% unless ENV['JOB_NAME'] == 'mariadb_leader_z1' %>
    wsrep_cluster_address = gcomm://<%= leader_address %>
  <% else %>
    wsrep_cluster_address = gcomm://
  <% end %>
<% end %>

#optional settings for galera/wsrep
#wsrep_provider_options="gcache.size=32G"
#wsrep_cluster_name='my_galera_cluster'
#wsrep_node_address=''
#wsrep_node_name='node2'
#wsrep_sst_method=xtrabackup
#wsrep_sst_auth=root:rootpa$$
#wsrep_node_incoming_address=''
#wsrep_sst_donor='node3'
#wsrep_slave_threads=16

binlog_format=ROW

[innodb]
default_storage_engine=InnoDB
innodb_autoinc_lock_mode=2
innodb_locks_unsafe_for_binlog=1
innodb_data_file_path=ibdata1:10M:autoextend
innodb_data_home_dir = /var/vcap/store/mariadb/
innodb_log_group_home_dir = /var/vcap/sys/log/mariadb/
innodb_log_arch_dir = /var/vcap/sys/log/mariadb/


